<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HealNest - Mood Tracker</title>
    <link rel="shortcut icon" type="image/png" href="../calm_clarity/assets/images/logos/favicon.png" />
    <link rel="stylesheet" href="../calm_clarity/assets/css/styles.min.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        .mood-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .mood-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, #13DEB9 0%, #539BFF 100%);
            color: white;
            border-radius: 15px;
        }
        
        .mood-selector {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .mood-options {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .mood-option {
            text-align: center;
            cursor: pointer;
            padding: 1.5rem;
            border-radius: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            min-width: 120px;
            flex: 1;
            max-width: 150px;
        }
        
        .mood-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .mood-option.selected {
            border-color: #13DEB9;
            background: linear-gradient(135deg, #13DEB9 0%, #20c997 100%);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(19, 222, 185, 0.4);
        }
        
        .mood-emoji {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .mood-label {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .mood-note {
            margin-top: 2rem;
        }
        
        .mood-note textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .mood-note textarea:focus {
            outline: none;
            border-color: #13DEB9;
        }
        
        .save-mood-btn {
            background: linear-gradient(135deg, #13DEB9 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }
        
        .save-mood-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(19, 222, 185, 0.4);
        }
        
        .mood-analytics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .analytics-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .analytics-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #2A3547;
        }
        
        .mood-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-day.has-mood {
            color: white;
        }
        
        .calendar-day.mood-excellent { background: #28a745; }
        .calendar-day.mood-good { background: #20c997; }
        .calendar-day.mood-neutral { background: #6c757d; }
        .calendar-day.mood-challenging { background: #ffc107; color: #000; }
        .calendar-day.mood-difficult { background: #dc3545; }
        
        .calendar-day:hover {
            transform: scale(1.1);
        }
        
        .mood-stats {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .stat-label {
            font-weight: 600;
            color: #2A3547;
        }
        
        .stat-value {
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .mood-trend {
            text-align: center;
            padding: 2rem;
        }
        
        .trend-indicator {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .trend-text {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .recent-entries {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .entry-item {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .entry-item:last-child {
            border-bottom: none;
        }
        
        .entry-mood {
            font-size: 1.5rem;
        }
        
        .entry-details {
            flex: 1;
        }
        
        .entry-date {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .entry-note {
            font-size: 0.9rem;
            color: #2A3547;
            margin-top: 0.25rem;
        }
        
        .back-btn {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .back-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        
        @media (max-width: 768px) {
            .mood-container {
                padding: 1rem;
            }
            
            .mood-options {
                justify-content: center;
            }
            
            .mood-option {
                min-width: 100px;
                max-width: 120px;
            }
            
            .mood-analytics {
                grid-template-columns: 1fr;
            }
            
            .back-btn {
                top: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>

<body>
    <button class="back-btn" onclick="window.location.href='./dashboard.html'">
        <i class="ti ti-arrow-left"></i>
    </button>

    <div class="mood-container">
        <!-- Mood Header -->
        <div class="mood-header">
            <h1 class="mb-3">Mood Tracker</h1>
            <p class="mb-0">Track your daily mood and emotions to better understand your mental wellness patterns.</p>
        </div>

        <!-- Today's Mood Selector -->
        <div class="mood-selector">
            <h3 class="mb-4">How are you feeling today?</h3>
            
            <div class="mood-options">
                <div class="mood-option" data-mood="excellent">
                    <span class="mood-emoji">üòÑ</span>
                    <div class="mood-label">Excellent</div>
                </div>
                <div class="mood-option" data-mood="good">
                    <span class="mood-emoji">üòä</span>
                    <div class="mood-label">Good</div>
                </div>
                <div class="mood-option" data-mood="neutral">
                    <span class="mood-emoji">üòê</span>
                    <div class="mood-label">Neutral</div>
                </div>
                <div class="mood-option" data-mood="challenging">
                    <span class="mood-emoji">üòî</span>
                    <div class="mood-label">Challenging</div>
                </div>
                <div class="mood-option" data-mood="difficult">
                    <span class="mood-emoji">üò¢</span>
                    <div class="mood-label">Difficult</div>
                </div>
            </div>

            <div class="mood-note">
                <label for="moodNote" class="form-label">Add a note (optional)</label>
                <textarea id="moodNote" placeholder="What's on your mind? How are you feeling today?"></textarea>
            </div>

            <button class="save-mood-btn" onclick="saveMood()">Save Today's Mood</button>
        </div>

        <!-- Mood Analytics -->
        <div class="mood-analytics">
            <!-- Mood Calendar -->
            <div class="analytics-card">
                <h4 class="analytics-title">This Month</h4>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <button class="btn btn-sm btn-outline-primary" onclick="previousMonth()">‚Äπ</button>
                    <span id="currentMonth" class="fw-bold"></span>
                    <button class="btn btn-sm btn-outline-primary" onclick="nextMonth()">‚Ä∫</button>
                </div>
                <div class="mood-calendar" id="moodCalendar">
                    <!-- Calendar will be generated here -->
                </div>
            </div>

            <!-- Mood Statistics -->
            <div class="analytics-card">
                <h4 class="analytics-title">Mood Statistics</h4>
                <div class="mood-stats" id="moodStats">
                    <!-- Stats will be generated here -->
                </div>
            </div>

            <!-- Mood Trend -->
            <div class="analytics-card">
                <h4 class="analytics-title">Weekly Trend</h4>
                <div class="mood-trend" id="moodTrend">
                    <div class="trend-indicator">üìà</div>
                    <div class="trend-text">Analyzing your mood patterns...</div>
                </div>
            </div>

            <!-- Recent Entries -->
            <div class="analytics-card">
                <h4 class="analytics-title">Recent Entries</h4>
                <div class="recent-entries" id="recentEntries">
                    <!-- Recent entries will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="../calm_clarity/assets/libs/jquery/dist/jquery.min.js"></script>
    <script src="../calm_clarity/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
    
    <script>
        let selectedMood = null;
        let currentDate = new Date();

        // Mood emojis mapping
        const moodEmojis = {
            excellent: 'üòÑ',
            good: 'üòä',
            neutral: 'üòê',
            challenging: 'üòî',
            difficult: 'üò¢'
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadTodaysMood();
            generateCalendar();
            updateMoodStats();
            updateMoodTrend();
            loadRecentEntries();
            
            // Add click handlers for mood options
            document.querySelectorAll('.mood-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    document.querySelectorAll('.mood-option').forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    selectedMood = this.dataset.mood;
                });
            });
        });

        function loadTodaysMood() {
            const todayMood = MoodTracker.getTodayMood();
            if (todayMood) {
                selectedMood = todayMood.mood;
                document.querySelector(`[data-mood="${todayMood.mood}"]`).classList.add('selected');
                document.getElementById('moodNote').value = todayMood.note || '';
            }
        }

        function saveMood() {
            if (!selectedMood) {
                alert('Please select a mood first.');
                return;
            }

            const note = document.getElementById('moodNote').value.trim();
            
            try {
                MoodTracker.saveMood(selectedMood, note);
                
                // Show success message
                const btn = document.querySelector('.save-mood-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Mood Saved! ‚úì';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);

                // Refresh analytics
                generateCalendar();
                updateMoodStats();
                updateMoodTrend();
                loadRecentEntries();
                
            } catch (error) {
                alert('Error saving mood. Please try again.');
            }
        }

        function generateCalendar() {
            const calendar = document.getElementById('moodCalendar');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            calendar.innerHTML = '';

            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.textContent = day;
                header.style.fontWeight = 'bold';
                header.style.textAlign = 'center';
                header.style.padding = '0.5rem';
                header.style.color = '#6c757d';
                calendar.appendChild(header);
            });

            // Generate calendar days
            const moodData = MoodTracker.getMoodData();
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                const dateString = date.toISOString().split('T')[0];
                const dayMood = moodData[dateString];
                
                if (dayMood) {
                    dayElement.classList.add('has-mood', `mood-${dayMood.mood}`);
                    dayElement.title = `${dayMood.mood}${dayMood.note ? ': ' + dayMood.note : ''}`;
                }
                
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayElement.style.opacity = '0.3';
                }
                
                if (date.toDateString() === new Date().toDateString()) {
                    dayElement.style.border = '2px solid #13DEB9';
                }
                
                calendar.appendChild(dayElement);
            }
        }

        function updateMoodStats() {
            const stats = MoodTracker.getMoodStats();
            const statsContainer = document.getElementById('moodStats');
            
            const moodLabels = {
                excellent: 'Excellent Days',
                good: 'Good Days',
                neutral: 'Neutral Days',
                challenging: 'Challenging Days',
                difficult: 'Difficult Days'
            };

            const moodColors = {
                excellent: '#28a745',
                good: '#20c997',
                neutral: '#6c757d',
                challenging: '#ffc107',
                difficult: '#dc3545'
            };

            statsContainer.innerHTML = Object.entries(stats.moods).map(([mood, count]) => `
                <div class="stat-item">
                    <div class="stat-label">
                        <span style="color: ${moodColors[mood]};">${moodEmojis[mood]}</span>
                        ${moodLabels[mood]}
                    </div>
                    <div class="stat-value" style="color: ${moodColors[mood]};">${count}</div>
                </div>
            `).join('');

            // Add total entries
            statsContainer.innerHTML += `
                <div class="stat-item" style="border-top: 2px solid #e9ecef; margin-top: 1rem; padding-top: 1rem;">
                    <div class="stat-label">Total Entries</div>
                    <div class="stat-value" style="color: #13DEB9;">${stats.total}</div>
                </div>
            `;
        }

        function updateMoodTrend() {
            const moodData = MoodTracker.getMoodData();
            const trendContainer = document.getElementById('moodTrend');
            
            // Get last 7 days
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                last7Days.push(moodData[dateString]);
            }

            // Calculate trend
            const moodValues = {
                excellent: 5,
                good: 4,
                neutral: 3,
                challenging: 2,
                difficult: 1
            };

            const validDays = last7Days.filter(day => day);
            if (validDays.length < 2) {
                trendContainer.innerHTML = `
                    <div class="trend-indicator">üìä</div>
                    <div class="trend-text">Not enough data for trend analysis</div>
                `;
                return;
            }

            const firstHalf = validDays.slice(0, Math.ceil(validDays.length / 2));
            const secondHalf = validDays.slice(Math.ceil(validDays.length / 2));

            const firstAvg = firstHalf.reduce((sum, day) => sum + moodValues[day.mood], 0) / firstHalf.length;
            const secondAvg = secondHalf.reduce((sum, day) => sum + moodValues[day.mood], 0) / secondHalf.length;

            let trendIcon, trendText, trendColor;
            
            if (secondAvg > firstAvg + 0.3) {
                trendIcon = 'üìà';
                trendText = 'Your mood is trending upward!';
                trendColor = '#28a745';
            } else if (secondAvg < firstAvg - 0.3) {
                trendIcon = 'üìâ';
                trendText = 'Your mood has been declining';
                trendColor = '#dc3545';
            } else {
                trendIcon = 'üìä';
                trendText = 'Your mood is stable';
                trendColor = '#6c757d';
            }

            trendContainer.innerHTML = `
                <div class="trend-indicator">${trendIcon}</div>
                <div class="trend-text" style="color: ${trendColor};">${trendText}</div>
            `;
        }

        function loadRecentEntries() {
            const moodData = MoodTracker.getMoodData();
            const entriesContainer = document.getElementById('recentEntries');
            
            // Convert to array and sort by date
            const entries = Object.entries(moodData)
                .map(([date, data]) => ({ date, ...data }))
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);

            if (entries.length === 0) {
                entriesContainer.innerHTML = '<p class="text-muted text-center">No mood entries yet. Start tracking your mood today!</p>';
                return;
            }

            entriesContainer.innerHTML = entries.map(entry => `
                <div class="entry-item">
                    <div class="entry-mood">${moodEmojis[entry.mood]}</div>
                    <div class="entry-details">
                        <div class="entry-date">${formatDate(entry.date)}</div>
                        ${entry.note ? `<div class="entry-note">${entry.note}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            if (date.toDateString() === today.toDateString()) {
                return 'Today';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return 'Yesterday';
            } else {
                return date.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }
        }
    </script>
</body>
</html>