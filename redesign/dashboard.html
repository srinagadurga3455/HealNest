<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - HealNest</title>
    <link rel="stylesheet" href="../redesign/styles.css">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <a href="./dashboard.html" class="logo" style="display: block; padding: 0 24px; margin-bottom: 32px;">HealNest</a>
            
            <a href="./dashboard.html" class="sidebar-item active">Dashboard</a>
            <a href="./program.html" class="sidebar-item">Today's Task</a>
            <a href="./profile.html" class="sidebar-item">Profile</a>
            
            <a href="#" class="sidebar-item logout" data-logout>Logout</a>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container">
                <!-- Welcome Header -->
                <div style="margin-bottom: 48px;">
                    <h1 id="greeting">Good morning</h1>
                    <p style="color: #999; margin-bottom: 0;">Here's your daily overview</p>
                </div>

                <!-- Stats Grid -->
                <div class="grid-3" style="margin-bottom: 48px;">
                    <div class="stat-box">
                        <div class="stat-number" id="currentStreak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="highestStreak">0</div>
                        <div class="stat-label">Highest Streak</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="totalDays">0</div>
                        <div class="stat-label">Total Days</div>
                    </div>
                </div>

                <!-- Active Program -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title" id="programName">Loading...</h3>
                            <p class="text-muted" style="margin: 0;">Your personalized program</p>
                        </div>
                    </div>
                    <p id="programDescription">Complete today's task to maintain your streak.</p>
                    <a href="./program.html" class="btn btn-primary">View Today's Task</a>
                </div>

                <!-- Quick Links -->
                <div class="grid-2">
                    <div class="card">
                        <h3>Track Your Mood</h3>
                        <p>Log how you're feeling today</p>
                        <a href="./mood.html" class="btn btn-secondary btn-small">Log Mood</a>
                    </div>
                    <div class="card">
                        <h3>Journal</h3>
                        <p>Reflect on your day</p>
                        <a href="./journal.html" class="btn btn-secondary btn-small">Write Entry</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../redesign/app.js"></script>
    <script src="../redesign/programs-data.js"></script>
    <script>
        // Check if user is logged in and assessment is completed
        const currentUser = localStorage.getItem('healNestCurrentUser');
        if (!currentUser) {
            window.location.href = './login.html';
        }

        const user = JSON.parse(currentUser);
        if (!user.assessmentCompleted) {
            window.location.href = './assessment.html';
        }

        // Update greeting
        const hour = new Date().getHours();
        let greeting = 'Good morning';
        if (hour >= 12 && hour < 18) greeting = 'Good afternoon';
        if (hour >= 18) greeting = 'Good evening';
        document.querySelector('h1').textContent = `${greeting}, ${user.fullName.split(' ')[0]}`;

        // Update stats
        document.getElementById('currentStreak').textContent = user.currentStreak || 0;
        document.getElementById('highestStreak').textContent = user.highestStreak || user.totalStreak || 0;
        document.getElementById('totalDays').textContent = user.totalStreak || 0;

        // Get program details
        const program = PROGRAMS.find(p => p.name === user.activeProgram);
        
        if (program) {
            document.getElementById('programName').textContent = program.name;
            
            const currentTaskIndex = user.currentTaskIndex || 0;
            const daysRemaining = program.tasks.length - currentTaskIndex;
            const progressPercent = ((currentTaskIndex + 1) / program.tasks.length) * 100;
            
            const programDescriptions = {
                'Intensive Support': `A focused ${program.duration}-day program to manage stress and build coping mechanisms. ${daysRemaining} days remaining.`,
                'Stress Management': `A comprehensive ${program.duration}-day program to build sustainable stress management habits. ${daysRemaining} days remaining.`,
                'Balance & Focus': `A ${program.duration}-day program to improve focus, productivity, and emotional balance. ${daysRemaining} days remaining.`,
                'Optimization': `An advanced ${program.duration}-day program for continuous personal improvement. ${daysRemaining} days remaining.`
            };

            document.getElementById('programDescription').textContent = programDescriptions[program.name] || `Your personalized ${program.duration}-day program.`;
        } else {
            document.getElementById('programDescription').textContent = 'Complete today\'s task to maintain your streak.';
        }
    </script>
</body>
</html>
