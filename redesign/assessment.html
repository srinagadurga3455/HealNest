<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment - HealNest</title>
    <link rel="stylesheet" href="../redesign/styles.css">
</head>
<body>
    <div class="small-container" style="padding-top: 48px; padding-bottom: 48px;">
        <div style="max-width: 600px; margin: 0 auto;">
            <h1>Mental Wellness Assessment</h1>
            <p style="color: #999; margin-bottom: 48px;">Answer 5 quick questions to get started. This helps us personalize your experience.</p>

            <form id="assessmentForm">
                <!-- Question 1: Stress -->
                <div class="card">
                    <h3>How stressed do you feel right now?</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="stress" value="1" required>
                            <span>Not stressed at all</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="stress" value="2">
                            <span>Slightly stressed</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="stress" value="3">
                            <span>Moderately stressed</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="stress" value="4">
                            <span>Very stressed</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="stress" value="5">
                            <span>Extremely stressed</span>
                        </label>
                    </div>
                </div>

                <!-- Question 2: Focus -->
                <div class="card">
                    <h3>How would you rate your ability to focus?</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="focus" value="5" required>
                            <span>Excellent focus</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="focus" value="4">
                            <span>Good focus</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="focus" value="3">
                            <span>Average focus</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="focus" value="2">
                            <span>Difficulty focusing</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="focus" value="1">
                            <span>Very poor focus</span>
                        </label>
                    </div>
                </div>

                <!-- Question 3: Energy -->
                <div class="card">
                    <h3>What's your energy level today?</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="energy" value="5" required>
                            <span>Very high energy</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="energy" value="4">
                            <span>Good energy</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="energy" value="3">
                            <span>Average energy</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="energy" value="2">
                            <span>Low energy</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="energy" value="1">
                            <span>Very low energy</span>
                        </label>
                    </div>
                </div>

                <!-- Question 4: Emotional Control -->
                <div class="card">
                    <h3>How well do you manage your emotions?</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="emotions" value="5" required>
                            <span>Very well</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="emotions" value="4">
                            <span>Good</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="emotions" value="3">
                            <span>Neutral</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="emotions" value="2">
                            <span>Struggle sometimes</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="emotions" value="1">
                            <span>Struggle often</span>
                        </label>
                    </div>
                </div>

                <!-- Question 5: Motivation -->
                <div class="card">
                    <h3>How motivated are you to improve?</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="motivation" value="5" required>
                            <span>Very motivated</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="motivation" value="4">
                            <span>Motivated</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="motivation" value="3">
                            <span>Somewhat motivated</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="motivation" value="2">
                            <span>Lacking motivation</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="motivation" value="1">
                            <span>Not motivated</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block" style="margin-top: 32px;">Complete Assessment</button>
            </form>
        </div>
    </div>

    <script src="../redesign/app.js"></script>
    <script>
        // Check if user is logged in
        const currentUser = localStorage.getItem('healNestCurrentUser');
        if (!currentUser) {
            window.location.href = './login.html';
        }

        // If assessment already completed, redirect to dashboard
        const user = JSON.parse(currentUser);
        if (user.assessmentCompleted) {
            window.location.href = './dashboard.html';
        }

        document.getElementById('assessmentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const stress = parseInt(document.querySelector('input[name="stress"]:checked').value);
            const focus = parseInt(document.querySelector('input[name="focus"]:checked').value);
            const energy = parseInt(document.querySelector('input[name="energy"]:checked').value);
            const emotions = parseInt(document.querySelector('input[name="emotions"]:checked').value);
            const motivation = parseInt(document.querySelector('input[name="motivation"]:checked').value);

            const score = stress + focus + energy + emotions + motivation;

            // Assign program based on score
            let program = 'Stress Management';
            if (score <= 10) {
                program = 'Intensive Support';
            } else if (score <= 15) {
                program = 'Stress Management';
            } else if (score <= 20) {
                program = 'Balance & Focus';
            } else {
                program = 'Optimization';
            }

            // Update user assessment
            const users = JSON.parse(localStorage.getItem('healNestUsers') || '[]');
            const userIndex = users.findIndex(u => u.id === user.id);
            if (userIndex !== -1) {
                users[userIndex].assessmentCompleted = true;
                users[userIndex].assessmentScore = score;
                users[userIndex].activeProgram = program;
                users[userIndex].currentStreak = 0;
                users[userIndex].totalStreak = 0;
                users[userIndex].highestStreak = 0;
                users[userIndex].currentTaskIndex = 0;
                users[userIndex].programStartDate = new Date().toISOString();
                users[userIndex].completedTasks = [];
                localStorage.setItem('healNestUsers', JSON.stringify(users));
                
                users[userIndex].assessmentCompleted = true;
                users[userIndex].assessmentScore = score;
                users[userIndex].activeProgram = program;
                users[userIndex].currentTaskIndex = 0;
                localStorage.setItem('healNestCurrentUser', JSON.stringify(users[userIndex]));
            }

            alert(`Based on your assessment, you're assigned to: ${program}`);
            window.location.href = './dashboard.html';
        });
    </script>
</body>
</html>
